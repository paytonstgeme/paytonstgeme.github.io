<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Posts - Payton St. Geme</title>

  <!-- Main stylesheet (includes EB Garamond + Material Symbols) -->
  <link rel="stylesheet" href="/style.css">

  <!-- Preload shared header -->
  <link rel="preload" href="/header.html" as="fetch" crossorigin>

  <!-- Load shared header (menu, sidebar, back-button logic) -->
  <script>
    fetch('/header.html')
      .then(r => r.text())
      .then(html => document.getElementById('shared-header').innerHTML = html);
  </script>
</head>

<body>
  <!-- Shared UI: menu, sidebar, backdrop -->
  <div id="shared-header"></div>

  <!-- PAGE-SPECIFIC HEADER: logo + brand -->
  <header class="header">
    <div class="container masthead">
      <img src="/assets/newlogo.png" alt="Logo" class="logo">
      <div class="brandline">PAYTON ST. GEME</div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="container posts-list">
    <h1>Posts</h1>
    <ul class="list" id="posts-list">
      <!-- Filled by JS -->
    </ul>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <p>Â© <span id="year"></span> Payton St. Geme</p>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script>
    // === Footer year ===
    document.getElementById('year').textContent = new Date().getFullYear();

    // === Load posts from JSON ===
    fetch('/posts_index.json')
      .then(r => r.json())
      .then(posts => {
        const list = document.getElementById('posts-list');
        list.innerHTML = '';
        posts.forEach(p => {
          const li = document.createElement('li');
          li.className = 'item';
          li.innerHTML = `
            <a class="item-title" href="${p.url}">${p.title}</a>
            <p class="item-desc">${p.desc || ''}</p>
            <time class="item-date" datetime="${p.date}">${formatDate(p.date)}</time>
          `;
          list.appendChild(li);
        });
      });

    function formatDate(iso) {
      if (!iso) return '';
      const d = new Date(iso);
      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      return `${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
    }

    // === Active nav & menu wiring (runs after header loads) ===
    const checkHeader = setInterval(() => {
      const header = document.getElementById('shared-header');
      if (header && header.innerHTML) {
        clearInterval(checkHeader);

        // --- Set active link ---
        const isPostsPage = location.pathname === '/posts.html' || location.pathname.startsWith('/posts/');
        header.querySelectorAll('.nav-link').forEach(a => a.classList.remove('active'));
        if (isPostsPage) {
          const link = header.querySelector('.nav a[href="/posts.html"]');
          if (link) link.classList.add('active');
        }

        // --- Menu toggle (already in header.html, but safe to re-wire) ---
        const btn = header.querySelector('.menu-button');
        const sidebar = header.querySelector('.sidebar');
        const backdrop = header.querySelector('.backdrop');

        function openMenu() {
          sidebar?.classList.add('open');
          document.body.classList.add('menu-open');
          btn?.setAttribute('aria-expanded', 'true');
          sidebar?.setAttribute('aria-hidden', 'false');
          if (backdrop) backdrop.hidden = false;
        }
        function closeMenu() {
          sidebar?.classList.remove('open');
          document.body.classList.remove('menu-open');
          btn?.setAttribute('aria-expanded', 'false');
          sidebar?.setAttribute('aria-hidden', 'true');
          if (backdrop) backdrop.hidden = true;
        }

        btn?.addEventListener('click', () => 
          sidebar?.classList.contains('open') ? closeMenu() : openMenu()
        );
        backdrop?.addEventListener('click', closeMenu);
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeMenu(); });
      }
    }, 50);
  </script>
</body>
</html>
